{"ast":null,"code":"/** \r\n * TSX\r\n * ASYNC\r\n * DESYNC\r\n */\nconst createTokenProvider = () => {\n  let _token = JSON.parse(localStorage.getItem('REACT_TOKEN_AUTH') || '') || null;\n  /* Implementation */\n\n\n  const getExpirationDate = jwtToken => {\n    if (!jwtToken) {\n      return null;\n    }\n\n    const jwt = JSON.parse(atob(jwtToken.split('.')[1])); // multiply by 1000 to convert seconds into milliseconds\n\n    return jwt && jwt.exp && jwt.exp * 1000 || null;\n  };\n\n  const isExpired = exp => {\n    if (!exp) {\n      return false;\n    }\n\n    return Date.now() > exp;\n  };\n\n  const getToken = async () => {\n    if (!_token) {\n      return null;\n    }\n\n    if (isExpired(getExpirationDate(_token.accessToken))) {\n      const updatedToken = await fetch('/update-token', {\n        method: 'POST',\n        body: _token.refreshToken\n      }).then(r => r.json());\n      setToken(updatedToken);\n    }\n\n    return _token && _token.accessToken;\n  };\n\n  const isLoggedIn = () => {\n    return !!_token;\n  };\n\n  let observers = [];\n\n  const subscribe = observer => {\n    observers.push(observer);\n  };\n\n  const notify = () => {\n    const isLogged = isLoggedIn();\n    observers.forEach(observer => observer(isLogged));\n  };\n\n  const unsubscribe = observer => {\n    observers = observers.filter(_observer => _observer !== observer);\n  };\n\n  const setToken = token => {\n    if (token) {\n      localStorage.setItem('REACT_TOKEN_AUTH', JSON.stringify(token));\n    } else {\n      localStorage.removeItem('REACT_TOKEN_AUTH');\n    }\n\n    _token = token;\n    notify();\n  };\n\n  return {\n    getExpirationDate\n  };\n};\n\nexport const {\n  getExpirationDate\n} = createTokenProvider();","map":{"version":3,"sources":["C:/Users/Nrudo/Documents/gitHub_projects/Stock/src/main/ui/src/components/createTokenProvider.tsx"],"names":["createTokenProvider","_token","JSON","parse","localStorage","getItem","getExpirationDate","jwtToken","jwt","atob","split","exp","isExpired","Date","now","getToken","accessToken","updatedToken","fetch","method","body","refreshToken","then","r","json","setToken","isLoggedIn","observers","subscribe","observer","push","notify","isLogged","forEach","unsubscribe","filter","_observer","token","setItem","stringify","removeItem"],"mappings":"AACA;AACA;AACA;AACA;AACA;AACA,MAAMA,mBAAmB,GAAG,MAAM;AAE9B,MAAIC,MAAqD,GACzDC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,kBAArB,KAA4C,EAAvD,KAA8D,IAD9D;AAEA;;;AACA,QAAMC,iBAAiB,GAAIC,QAAD,IAAsC;AAC5D,QAAI,CAACA,QAAL,EAAe;AACX,aAAO,IAAP;AACH;;AAED,UAAMC,GAAG,GAAGN,IAAI,CAACC,KAAL,CAAWM,IAAI,CAACF,QAAQ,CAACG,KAAT,CAAe,GAAf,EAAoB,CAApB,CAAD,CAAf,CAAZ,CAL4D,CAO5D;;AACA,WAAOF,GAAG,IAAIA,GAAG,CAACG,GAAX,IAAkBH,GAAG,CAACG,GAAJ,GAAU,IAA5B,IAAoC,IAA3C;AACH,GATD;;AAWA,QAAMC,SAAS,GAAID,GAAD,IAAkB;AAChC,QAAI,CAACA,GAAL,EAAU;AACN,aAAO,KAAP;AACH;;AAED,WAAOE,IAAI,CAACC,GAAL,KAAaH,GAApB;AACH,GAND;;AAQA,QAAMI,QAAQ,GAAG,YAAY;AACzB,QAAI,CAACd,MAAL,EAAa;AACT,aAAO,IAAP;AACH;;AAED,QAAIW,SAAS,CAACN,iBAAiB,CAACL,MAAM,CAACe,WAAR,CAAlB,CAAb,EAAsD;AAClD,YAAMC,YAAY,GAAG,MAAMC,KAAK,CAAC,eAAD,EAAkB;AAC9CC,QAAAA,MAAM,EAAE,MADsC;AAE9CC,QAAAA,IAAI,EAAEnB,MAAM,CAACoB;AAFiC,OAAlB,CAAL,CAItBC,IAJsB,CAIjBC,CAAC,IAAIA,CAAC,CAACC,IAAF,EAJY,CAA3B;AAMAC,MAAAA,QAAQ,CAACR,YAAD,CAAR;AACH;;AAED,WAAOhB,MAAM,IAAIA,MAAM,CAACe,WAAxB;AACH,GAhBD;;AAkBA,QAAMU,UAAU,GAAG,MAAM;AACrB,WAAO,CAAC,CAACzB,MAAT;AACH,GAFD;;AAIA,MAAI0B,SAA6C,GAAG,EAApD;;AAEA,QAAMC,SAAS,GAAIC,QAAD,IAA2C;AACzDF,IAAAA,SAAS,CAACG,IAAV,CAAeD,QAAf;AACH,GAFD;;AAIA,QAAME,MAAM,GAAG,MAAM;AACjB,UAAMC,QAAQ,GAAGN,UAAU,EAA3B;AACAC,IAAAA,SAAS,CAACM,OAAV,CAAkBJ,QAAQ,IAAIA,QAAQ,CAACG,QAAD,CAAtC;AACH,GAHD;;AAKA,QAAME,WAAW,GAAIL,QAAD,IAA2C;AAC3DF,IAAAA,SAAS,GAAGA,SAAS,CAACQ,MAAV,CAAiBC,SAAS,IAAIA,SAAS,KAAKP,QAA5C,CAAZ;AACH,GAFD;;AAIA,QAAMJ,QAAQ,GAAIY,KAAD,IAA0B;AACvC,QAAIA,KAAJ,EAAW;AACPjC,MAAAA,YAAY,CAACkC,OAAb,CAAqB,kBAArB,EAAyCpC,IAAI,CAACqC,SAAL,CAAeF,KAAf,CAAzC;AACH,KAFD,MAEO;AACHjC,MAAAA,YAAY,CAACoC,UAAb,CAAwB,kBAAxB;AACH;;AACDvC,IAAAA,MAAM,GAAGoC,KAAT;AACAN,IAAAA,MAAM;AACT,GARD;;AAUA,SAAO;AACHzB,IAAAA;AADG,GAAP;AAGH,CA1ED;;AA4EA,OAAO,MAAM;AAACA,EAAAA;AAAD,IAAsBN,mBAAmB,EAA/C","sourcesContent":["\r\n/** \r\n * TSX\r\n * ASYNC\r\n * DESYNC\r\n */\r\nconst createTokenProvider = () => {\r\n\r\n    let _token: { accessToken: string, refreshToken: string } = \r\n    JSON.parse(localStorage.getItem('REACT_TOKEN_AUTH') || '') || null;\r\n    /* Implementation */\r\n    const getExpirationDate = (jwtToken?: string): number | null => {\r\n        if (!jwtToken) {\r\n            return null;\r\n        }\r\n    \r\n        const jwt = JSON.parse(atob(jwtToken.split('.')[1]));\r\n    \r\n        // multiply by 1000 to convert seconds into milliseconds\r\n        return jwt && jwt.exp && jwt.exp * 1000 || null;\r\n    };\r\n\r\n    const isExpired = (exp?: number) => {\r\n        if (!exp) {\r\n            return false;\r\n        }\r\n    \r\n        return Date.now() > exp;\r\n    };\r\n\r\n    const getToken = async () => {\r\n        if (!_token) {\r\n            return null;\r\n        }\r\n    \r\n        if (isExpired(getExpirationDate(_token.accessToken))) {\r\n            const updatedToken = await fetch('/update-token', {\r\n                method: 'POST',\r\n                body: _token.refreshToken\r\n            })\r\n                .then(r => r.json());\r\n    \r\n            setToken(updatedToken);\r\n        }\r\n    \r\n        return _token && _token.accessToken;\r\n    };\r\n\r\n    const isLoggedIn = () => {\r\n        return !!_token;\r\n    };\r\n\r\n    let observers: Array<(isLogged: boolean) => void> = [];\r\n\r\n    const subscribe = (observer: (isLogged: boolean) => void) => {\r\n        observers.push(observer);\r\n    };\r\n    \r\n    const notify = () => {\r\n        const isLogged = isLoggedIn();\r\n        observers.forEach(observer => observer(isLogged));\r\n    };\r\n\r\n    const unsubscribe = (observer: (isLogged: boolean) => void) => {\r\n        observers = observers.filter(_observer => _observer !== observer);\r\n    };\r\n\r\n    const setToken = (token: typeof _token) => {\r\n        if (token) {\r\n            localStorage.setItem('REACT_TOKEN_AUTH', JSON.stringify(token));\r\n        } else {\r\n            localStorage.removeItem('REACT_TOKEN_AUTH');\r\n        }\r\n        _token = token;\r\n        notify();\r\n    };\r\n\r\n    return {\r\n        getExpirationDate,\r\n    };\r\n};\r\n\r\nexport const {getExpirationDate} = createTokenProvider();"]},"metadata":{},"sourceType":"module"}